%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The components are:
% For flag=0, the tensor is of the form: A(i,k)B(j,l) 
% For flag=1, the tensor is of the form: A(i,j)B(k,l) 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function [vectorised_four_order_tensor]        =  four_order_tensor_vectorisation(A,B,flag,dim)



switch dim
    case 2
         switch flag 
                case 0
                     vectorised_four_order_tensor   =  [A(1,1)*B(1,1); A(1,2)*B(1,2); 0.5*(A(1,1)*B(1,2) + A(1,2)*B(1,1)); ...
                                                        A(2,2)*B(2,2); 0.5*(A(2,1)*B(2,2) + A(2,2)*B(2,1)); ...
                                                        0.5*(A(1,1)*B(2,2) + A(1,2)*B(2,1))];                    
                case 1
                     vectorised_four_order_tensor   =  [A(1,1)*B(1,1); A(1,1)*B(2,2); 0.5*(A(1,1)*B(1,2) + A(1,1)*B(2,1)); ...
                                                        A(2,2)*B(2,2); 0.5*(A(2,2)*B(1,2) + A(2,2)*B(2,1));  ...
                                                        0.5*(A(1,2)*B(1,2) + A(1,2)*B(2,1))];     
         end
    case 3
         switch flag 
                case 0
                     vectorised_four_order_tensor   =  [A(1,1)*B(1,1); A(1,2)*B(1,2); A(1,3)*B(1,3); 0.5*(A(1,1)*B(1,2) + A(1,2)*B(1,1)); 0.5*(A(1,1)*B(1,3) +  A(1,3)*B(2,1));  0.5*(A(1,2)*B(1,3) + A(1,3)*B(1,2));...
                                                        A(2,2)*B(2,2); A(2,3)*B(2,3); 0.5*(A(2,1)*B(2,2) + A(2,2)*B(2,1)); 0.5*(A(2,1)*B(2,3) +  A(2,3)*B(2,1));  0.5*(A(2,2)*B(2,3) + A(2,3)*B(2,2));...
                                                        A(3,3)*B(3,3); 0.5*(A(3,1)*B(3,2) + A(3,2)*B(3,1)); 0.5*(A(3,1)*B(3,3) +  A(3,3)*B(3,1));  0.5*(A(3,2)*B(3,3) + A(3,3)*B(3,2));...                       
                                                        0.5*(A(1,1)*B(2,2) + A(1,2)*B(2,1)); 0.5*(A(1,1)*B(2,3) +  A(1,3)*B(2,1));  0.5*(A(1,2)*B(2,3) + A(1,3)*B(2,2));...
                                                        0.5*(A(1,1)*B(3,3) +  A(1,3)*B(3,1));  0.5*(A(1,2)*B(3,3) + A(1,3)*B(3,2));...
                                                        0.5*(A(2,2)*B(3,3) + A(2,3)*B(3,2))];
                case 1
                     vectorised_four_order_tensor   =  [A(1,1)*B(1,1); A(1,1)*B(2,2); A(1,1)*B(3,3); 0.5*(A(1,1)*B(1,2) + A(1,1)*B(2,1)); 0.5*(A(1,1)*B(1,3) +  A(1,1)*B(3,1));  0.5*(A(1,1)*B(2,3) + A(1,1)*B(3,2));...
                                                        A(2,2)*B(2,2); A(2,2)*B(3,3); 0.5*(A(2,2)*B(1,2) + A(2,2)*B(2,1)); 0.5*(A(2,2)*B(1,3) +  A(2,2)*B(3,1));  0.5*(A(2,2)*B(2,3) + A(2,2)*B(3,2));...
                                                        A(3,3)*B(3,3); 0.5*(A(3,3)*B(1,2) + A(3,3)*B(2,1)); 0.5*(A(3,3)*B(1,3) +  A(3,3)*B(3,1));  0.5*(A(3,3)*B(2,3) + A(3,3)*B(3,2));...
                                                        0.5*(A(1,2)*B(1,2) + A(1,2)*B(2,1)); 0.5*(A(1,2)*B(1,3) +  A(1,2)*B(3,1));  0.5*(A(1,2)*B(2,3) + A(1,2)*B(3,2));...
                                                        0.5*(A(1,3)*B(1,3) +  A(1,3)*B(3,1));  0.5*(A(1,3)*B(2,3) + A(1,3)*B(3,2));...
                                                        0.5*(A(2,3)*B(2,3) + A(2,3)*B(3,2))];
         end
end